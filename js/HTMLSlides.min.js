/*! HTMLSlides 2014-03-31 */
function updateAspect(a){aspect=a.options[a.selectedIndex].value,resize()}function borders(a){}function view(a){var b=a||!1;lib.foreach(lib.sel("#toolbar,#container, #slide_main,#slidespreview"),function(a){a.dataset?a.dataset.edit=!1:a.setAttribute("data-edit","false")}),borders(!1),lib.foreach(active.children,function(a){UI.resizeable(a,"remove"),UI.draggable(a,"remove");var b=a.querySelector(".content-editable");b&&(b.setAttribute("contenteditable",!1),b.spellcheck=!1)}),b||(active.removeEventListener("contextmenu",addItemMenu),slideshow.start(active),navigation(!0),edit=!1,resize())}function preview(){document.body[window.getRFS()](),document.body.addEventListener("webkitfullscreenchange",UI.events.fsChange),document.body.addEventListener("mozfullscreenchange",UI.events.fsChange),document.body.addEventListener("fullscreenchange",UI.events.fsChange),location.hash="/edit",location.hash="/view"}function boxDrag(a){var b=a.target;b.top=(a.target.offsetTop-winH/2)/winH,b.left=(a.target.offsetLeft-winW/2)/winW,b.height=a.target.clientHeight/winH,b.width=a.target.clientWidth/winW;var a=new CustomEvent("updated",{canBubble:!0});b.dispatchEvent(a)}function setEdit(a){var b=a||!1;lib.foreach(lib.sel("#toolbar,#container, #slide_main,#slides_preview"),function(a){a.dataset?a.dataset.edit=!0:a.setAttribute("data-edit","true")}),borders(!0),lib.foreach(active.children,function(a){UI.resizeable(a,"set"),UI.draggable(a,"set",{cancel:'[contenteditable="true"]'});var b=a.querySelector(".content-editable");b&&(b.setAttribute("contenteditable",!0),b.spellcheck=!1),a.ontransformed=boxDrag}),b||(active.addEventListener("contextmenu",addItemMenu),navigation(!1),edit=!0,resize())}function addItemMenu(a){if(a.target==active){remove_menu(),lastClick.x=a.offsetX,lastClick.y=a.offsetY;var b=document.createElement("div");b.setAttribute("class","menu");var c=document.createElement("li");c.setAttribute("onclick",'Add_elem("text_area")'),c.innerHTML="Text Area",b.appendChild(c),c=document.createElement("li"),c.setAttribute("onclick",'Add_elem("image")'),c.innerHTML="Image",b.appendChild(c),c=document.createElement("li"),c.setAttribute("onclick",'Add_elem("video")'),c.innerHTML="video",b.appendChild(c),a.target.appendChild(b),b.style.position="absolute",b.style.top=lastClick.y+"px",b.style.left=lastClick.x+"px",a.preventDefault(),a.returnValue=!1,active.addEventListener("click",remove_menu)}}function remove_menu(){var a=document.getElementsByClassName("menu");if(a.length>0)for(i=0;i<a.length;i++)active.removeChild(a[i]);active.removeEventListener("click",remove_menu)}function route(){"#!"==window.location.hash&&(window.location.hash=lastSlideHash),window.location.hash.match(/#\/edit/)&&(lastSlideHash=window.location.hash,setEdit()),window.location.hash.match(/#\/view/)&&(lastSlideHash=window.location.hash,view())}function getDefaultFontSize(a){a=a||document.body;var b=document.createElement("div");b.style.width="1000em",a.appendChild(b);var c=b.offsetWidth/1e3;return a.removeChild(b),c}function initialize(){slideshow=new SlideShow,active=document.getElementById("slide_main"),newSlide(),emSize=getDefaultFontSize(active),resize(),window.onresize=resize,null==edit||1==edit?(setEdit(),window.location.hash="#/edit",active.addEventListener("contextmenu",addItemMenu)):(view(),window.location.hash="#/view"),window.onhashchange=route}function first(){count=0,subElemCount=0,attatch_listeners(),current=slides[count],hide(),load(),window.fullScreenApi.supportsFullScreen}function save_elem(){var a=document.createElement("script");a.innerHTML+="edit = false;",document.head.appendChild(a),saveAs(slideshow.save(),"slideshow.shw")}function load_from_store(){localStorage&&(slide_background=localStorage.slide_background,set_slide_background(),active.innerHTML=localStorage.savedHTML,ID_CT=localStorage.ID_CT,edit&&setEdit())}function changeBG(){var a=new Preview({type:"image",title:"Please choose a Background Image"});a.onselected=function(a){if(void 0==a)return!1;active.style.backgroundImage="url("+URL.createObjectURL(a)+")",slideshow.currentSlide.setBackground(a,a.name);var b=new CustomEvent("updated");return active.dispatchEvent(b),!0},a.show()}function Add_elem(a){if(slide=slideshow.currentSlide,"text_area"==a){ID_CT=slide.nextID();var b=document.createElement("div");b.setAttribute("class","text_area");var c=document.createElement("div");c.setAttribute("class","handle"),b.appendChild(c);var d=document.createElement("div");return d.className="slide_text content-editable",d.setAttribute("contenteditable",!0),d.innerHTML="",b.appendChild(d),active.appendChild(b),b.style.top=(lastClick.y||10)+"px",b.style.left=(lastClick.x||10)+"px",UI.resizeable(b,"set"),UI.draggable(b,"set",{cancel:'[contenteditable="true"]'}),b.ontransformed=boxDrag,boxDrag({target:b}),slide.add(b,"text",[]),borders(!0),b}if("image"==a){ID_CT=slide.nextID();var e=document.createElement("div");e.setAttribute("class","text_area slide-element-body");var c=lib.newEL("div",{className:"handle"});e.appendChild(c);var f=document.createElement("div");f.setAttribute("class","slide_text slide_img"),e.appendChild(f),UI.resizeable(e,"set"),UI.draggable(e,"set"),e.ontransformed=boxDrag,e.style.top=(lastClick.y||10)+"px",e.style.left=(lastClick.x||10)+"px";var g=new Preview({type:"image"});return g.onselected=function(a){f.style.backgroundImage="url("+URL.createObjectURL(a)+")",e.links=[],e.links.push("img.style.backgroundImage",a.name);var b={resource:a,link:{type:"css",id:"childNodes.1.style.backgroundImage"}};slide.add(e,"image",[b]),active.appendChild(e),boxDrag({target:e}),borders(!0)},g.show(),b}if("video"==a){ID_CT++;var b=document.createElement("div");b.setAttribute("class","text_area");var c=document.createElement("div");c.setAttribute("class","handle"),b.appendChild(c);var f=document.createElement("video");f.setAttribute("class","slide_text slide_img"),f.setAttribute("controls",!0),b.appendChild(f),UI.resizeable(b,"set"),UI.draggable(b,"set"),b.style.top=(lastClick.y||10)+"px",b.style.left=(lastClick.x||10)+"px";var g=new Preview({type:"video"});return g.onselected=function(a){f.src=URL.createObjectURL(a);var c={resource:a,link:{type:"url",id:"childNodes.1.src"}};slideshow.currentSlide.add(b,"image",[c]),active.appendChild(b),boxDrag({target:b}),borders(!0)},g.show(),b}return null}function load_slideshow(){var a=document.getElementById("slide_main");a.innerHTML="",slideshow.load(document.getElementById("loadNEW").files[0],function(){slide=slideshow.slides[0],ID_CT=slide.ID_CT,slideshow.render(0,active,!0),previewRender(),setEdit()})}function Remote_Slide(){remote=!0,$.get("../get?id="+ID,function(a){a!=Remote_last&&(Remote_last=a,$("body").append(script)),setTimeout(Remote_Slide,700)})}function jump_to(a,b){if(count=a,current=slides[count],hide(),load(),b)for(subElemCount=0;b>subElemCount;subElemCount++)current=slides[count].subElem[subElemCount],load()}function back(){slideshow.back(active)}function navigation(a){a?(window.addEventListener("keydown",UI.events.keyboard),active.addEventListener("swipeleft",next),active.addEventListener("swiperight",back),active.addEventListener("mouseup",UI.events.mouse)):(window.removeEventListener("keydown",UI.events.keyboard),active.removeEventListener("swipeleft",next),active.removeEventListener("swiperight",back),active.removeEventListener("mouseup",UI.events.mouse))}function next(){slideshow.next(active)}function hide(){document.getElementById("slide_head").innerHTML="",document.getElementById("slide_content").innerHTML=""}function load(){ID&&!remote&&jQuery.ajax({type:"GET",url:"../put?id="+ID+"&slide="+count+"&sub="+subElemCount,success:function(){}});var a="",b="";current.head&&(document.getElementById("slide_head").innerHTML+=current.head),current.type&&(a="<"+current.type+">",b="</"+current.type+">"),current.content&&(document.getElementById("slide_content").innerHTML+=a+current.content+b)}function newSlide(){var a=new Slide;slide=slideshow.addSlide(a),slideshow.currentSlide=slide,slide.render(active,!0),addSlidePreview(slide)}function addSlidePreview(a,b){var b=lib.selID("slides_preview"),c=lib.newEL("div",{className:"slide thumb"});c.addEventListener("click",function(){slideshow.render(a.id,active,!0),setEdit(),previewRender(a.id)}),active.addEventListener("keyup",function(a){var b=new CustomEvent("updated");a.target.parentNode.dispatchEvent(b)}),active.addEventListener("updated",function(b){if(slideshow.currentSlide.id==a.id){var d=b.srcElement||b.target;if(c.style.backgroundImage!=active.style.backgroundImage&&(c.style.backgroundImage=active.style.backgroundImage),active.children.length>c.children.length){var e=d.cloneNode(!0);e.top=d.top,e.left=d.left,e.width=d.width,e.height=d.height,d.index=c.children.length,c.appendChild(e)}else{var e=d.cloneNode(!0);e.top=d.top,e.left=d.left,e.width=d.width,e.height=d.height;var f=d.index;c.removeChild(c.children[f]),c.insertBefore(e,c.children[f])}slideResize(c)}},!0);b.children.length;b.insertBefore(c,b.lastChild),(b=b||!0)&&previewRender()}function previewRender(){for(var a=lib.selID("slides_preview").children,b=0;b<a.length;b++){var c=a[b];slideshow.currentSlide.id==b?c.style.borderColor="white":slideshow.slides.length>b&&(c.style.borderColor="",c==c.parentNode.lastChild&&(addSlidePreview({id:b},!1),c=a[b]),slideshow.render(b,c,!1),lib.foreach(c.children,function(a){UI.draggable(a,"remove"),UI.resizeable(a,"remove")}))}lib.foreach(lib.sel(".slide.thumb"),function(a){slideResize(a)})}function resize(a){if(null!=a&&a.target!=window)return!0;winW=630,winH=460;var b=winH,c=winW,d=lib.selID("slide_screen");d.clientHeight&&d.clientWidth&&(winW=d.clientWidth,winH=d.clientHeight),winW>winH*aspect?(c=winH*aspect,b=winH,active.style.width=c+"px",active.style.left=(winW-c)/2+"px"):(b=winW/aspect,c=winW,active.style.height=b+"px",active.style.top=(winH-b)/2+"px"),active.style.width=c+"px",active.style.left=(winW-c)/2+"px",active.style.height=b+"px",active.style.top=(winH-b)/2+"px";var e=2*(c/1024)+"em";active.style.fontSize=e,winW=c,winH=b;var f=document.getElementsByClassName("text_area");for(i=0;i<f.length;i++)(null==f[i].top||null==f[i].left)&&boxDrag({target:f[i]},null),f[i].style.top=f[i].top*b+b/2+"px",f[i].style.left=f[i].left*c+c/2+"px",f[i].style.height=f[i].height*b+"px",f[i].style.width=f[i].width*c+"px"}function slideResize(a){var b=a.clientWidth,c=b/aspect;a.style.height=c+"px";var d=2*(b/1024)+"em";a.style.fontSize=d,lib.foreach(a.querySelectorAll(".text_area"),function(a){a.style.top=a.top*c+c/2+"px",a.style.left=a.left*b+b/2+"px",a.style.height=a.height*c+"px",a.style.width=a.width*b+"px"})}if(function(a){function b(a){return array=new Uint32Array(2),array[0]=a.size,array}a.read_ArrayBuffer=function(a,b){var c=new FileReader;c.onload=function(){b(this.result)},c.readAsArrayBuffer(a)},a.read_String=function(a,b){var c=new FileReader;c.onload=function(){b(this.result)},c.readAsText(a)},a.prototype={resources:!1,header:{files:{}},add:function(a,b,c){var d=this,e={};if(e.length=a.size,e.type=a.type,c=c||{},e.atribs=c,this.resources){e.start=d.resources.size;var f=new Blob([d.resources,a]);d.resources=f}else e.start=0,d.resources=new Blob([a]);return this.header.total=d.resources.size,d.header.files[b]=e,d.resources.slice(e.start,e.start+e.length)},get:function(a){var b=this;if(a in b.header.files){var c=b.header.files[a];return this.resources.slice(c.start,c.start+c.length,c.type)}},list:function(){var a=[];for(name in this.header.files)a.push(name);return a},getBlob:function(){var a=new Blob([JSON.stringify(this.header)],{type:"application/json"}),c=b(a);return new Blob([c,a,this.resources],{type:"aplication/x-blob-archive"})},load:function(b,c){var d=this;d.header={},d.resources=[],a.read_ArrayBuffer(b.slice(0,8),function(e){var f=new Uint32Array(e)[0];a.read_String(b.slice(8,f+8),function(a){d.header=JSON.parse(a),d.resources=b.slice(f+8,b.size),void 0!=c&&"function"==typeof c&&c(d)})})},getHeader:function(){return this.header},getResources:function(){return this.resources}}}(window.Archive=window.Archive||function(a){void 0!=a&&this.load(a)}),"function"!=typeof Blob&&"object"!=typeof Blob||"undefined"==typeof URL)if("function"!=typeof Blob&&"object"!=typeof Blob||"undefined"==typeof webkitURL)var Blob=function(a){"use strict";var b=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder||function(a){var b=function(a){return Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1]},c=function(){this.data=[]},d=function(a,b,c){this.data=a,this.size=a.length,this.type=b,this.encoding=c},e=c.prototype,f=d.prototype,g=a.FileReaderSync,h=function(a){this.code=this[this.name=a]},i="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=i.length,k=a.URL||a.webkitURL||a,l=k.createObjectURL,m=k.revokeObjectURL,n=k,o=a.btoa,p=a.atob,q=a.ArrayBuffer,r=a.Uint8Array;for(d.fake=f.fake=!0;j--;)h.prototype[i[j]]=j+1;return k.createObjectURL||(n=a.URL={}),n.createObjectURL=function(a){var b,c=a.type;return null===c&&(c="application/octet-stream"),a instanceof d?(b="data:"+c,"base64"===a.encoding?b+";base64,"+a.data:"URI"===a.encoding?b+","+decodeURIComponent(a.data):o?b+";base64,"+o(a.data):b+","+encodeURIComponent(a.data)):l?l.call(k,a):void 0},n.revokeObjectURL=function(a){"data:"!==a.substring(0,5)&&m&&m.call(k,a)},e.append=function(a){var c=this.data;if(r&&(a instanceof q||a instanceof r)){for(var e="",f=new r(a),i=0,j=f.length;j>i;i++)e+=String.fromCharCode(f[i]);c.push(e)}else if("Blob"===b(a)||"File"===b(a)){if(!g)throw new h("NOT_READABLE_ERR");var k=new g;c.push(k.readAsBinaryString(a))}else a instanceof d?"base64"===a.encoding&&p?c.push(p(a.data)):"URI"===a.encoding?c.push(decodeURIComponent(a.data)):"raw"===a.encoding&&c.push(a.data):("string"!=typeof a&&(a+=""),c.push(unescape(encodeURIComponent(a))))},e.getBlob=function(a){return arguments.length||(a=null),new d(this.data.join(""),a,"raw")},e.toString=function(){return"[object BlobBuilder]"},f.slice=function(a,b,c){var e=arguments.length;return 3>e&&(c=null),new d(this.data.slice(a,e>1?b:this.data.length),c,this.encoding)},f.toString=function(){return"[object Blob]"},c}(a);return function(a,c){var d=c?c.type||"":"",e=new b;if(a)for(var f=0,g=a.length;g>f;f++)e.append(a[f]);return e.getBlob(d)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);else self.URL=webkitURL;!function(a){a.draggable=function(b,c,d){"set"==c&&(b.touchstart=function(c){c.preventDefault(),a.draggable.mousedown(b,d,c.touches[0])},b.onmousedown=function(c){a.draggable.mousedown(b,d,c)},window.addEventListener("touchstart",b.touchstart),b.setAttribute("draggable","false")),("unset"==c||"remove"==c||"none"==c)&&(b.onmousedown=null,b.touchstart&&window.removeEventListener("touchstart",b.touchstart),b.setAttribute("draggable","auto"))},a.draggable.mousedown=function(b,c,d){b.draggableOffsetX=d.clientX-b.offsetLeft,b.draggableOffsetY=d.clientY-b.offsetTop;var e={};if(!(c&&c.cancel&&lib.matches(d.target,c.cancel))){e.mov=window.onmousemove,e.up=window.onmouseup,window.onmousemove=function(c){a.draggable.mousemove(b,c)};var f=function(c){a.draggable.mousemove(b,c.touches[0])};window.addEventListener("touchmove",f),window.onmouseup=function(){window.onmousemove=e.mov,window.onmouseup=e.up,window.removeEventListener("touchmove",f),window.removeEventListener("touchend",window.onmouseup),b.draggableOffsetX=void 0,b.draggableOffsetY=void 0,b.ontransformed({target:b})},window.addEventListener("touchend",window.onmouseup)}},a.draggable.getSnapCoords=function(a,b){return clientRects=[],lib.foreach(b,function(a,b){lib.foreach(lib.sel(b),function(a){clientRects.push(a.getClientRects()[0])})}),clientRects},a.draggable.mousemove=function(a,b){a.style.left=b.clientX-a.draggableOffsetX+"px",a.style.top=b.clientY-a.draggableOffsetY+"px"}}(window.UI=window.UI||function(){});var saveAs=saveAs||navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if(!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=a.URL||a.webkitURL||a,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),f=!a.externalHost&&"download"in e,g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=[],m=function(){for(var a=l.length;a--;){var b=l[a];"string"==typeof b?d.revokeObjectURL(b):b.remove()}l.length=0},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(d,i){var m,o,p,q=this,r=d.type,s=!1,t=function(){var a=c().createObjectURL(d);return l.push(a),a},u=function(){n(q,"writestart progress write writeend".split(" "))},v=function(){(s||!m)&&(m=t(d)),o?o.location.href=m:window.open(m,"_blank"),q.readyState=q.DONE,u()},w=function(a){return function(){return q.readyState!==q.DONE?a.apply(this,arguments):void 0}},x={create:!0,exclusive:!1};if(q.readyState=q.INIT,i||(i="download"),f){m=t(d),b=a.document,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e.href=m,e.download=i;var y=b.createEvent("MouseEvents");return y.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(y),q.readyState=q.DONE,void u()}return a.chrome&&r&&r!==j&&(p=d.slice||d.webkitSlice,d=p.call(d,0,d.size,j),s=!0),g&&"download"!==i&&(i+=".download"),(r===j||g)&&(o=a),h?(k+=d.size,void h(a.TEMPORARY,k,w(function(a){a.root.getDirectory("saved",x,w(function(a){var b=function(){a.getFile(i,x,w(function(a){a.createWriter(w(function(b){b.onwriteend=function(b){o.location.href=a.toURL(),l.push(a),q.readyState=q.DONE,n(q,"writeend",b)},b.onerror=function(){var a=b.error;a.code!==a.ABORT_ERR&&v()},"writestart progress write abort".split(" ").forEach(function(a){b["on"+a]=q["on"+a]}),b.write(d),q.abort=function(){b.abort(),q.readyState=q.DONE},q.readyState=q.WRITING}),v)}),v)};a.getFile(i,{create:!1},w(function(a){a.remove(),b()}),w(function(a){a.code===a.NOT_FOUND_ERR?b():v()}))}),v)}),v)):void v()},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,a.addEventListener("unload",m,!1),q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&(module.exports=saveAs),function(a){a.prototype={onselected:null,ok:function(){var a=this,b=a.file.files[0];"function"==typeof a.onselected&&a.onselected(b),a.close()},handleFile:function(){var a=this,b=a.file.files[0];if(a.modal.inner.preview.innerHTML="","video"==a.type){var c=lib.newEL("video",{className:"Preview preview",attributes:{controls:!0},src:URL.createObjectURL(b)});a.modal.inner.preview.appendChild(c)}else if("image"==a.type){var d=lib.newEL("div",{className:"Preview Image preview"});d.style.backgroundImage="url("+URL.createObjectURL(b)+")",a.modal.inner.preview.appendChild(d)}},init:function(a){var b=this,c=lib.newEL("div",{className:"Preview background pbg"}),d=lib.newEL("div",{className:"Preview modal"}),e=lib.newEL("div",{className:"Preview modal-inner"}),f=lib.newEL("header",{className:"Preview"});f.innerHTML=void 0!=a?a.title||"Please choose a "+a.type+".":"Please choose a file.";var g=lib.newEL("div",{className:"Preview modal-buttons"}),h=lib.newEL("input",{attributes:{type:"file"},className:"Preview modal-file"});h.onchange=function(){b.handleFile()},b.file=e.appendChild(h);var i=lib.newEL("div",{className:"Preview modal-preview"});e.preview=e.appendChild(i);var j=lib.newEL("button",{onclick:function(){b.close()},className:"Preview modal-button",title:"Cancel file selection"});j.innerHTML="Cancel";var k=lib.newEL("button",{onclick:function(){b.ok()},className:"Preview modal-button",title:"Use this file"});k.innerHTML="Ok",g.appendChild(k),g.appendChild(j),d.head=f,d.inner=e,d.buttons=g,b.modal=d,b.bg=c,lib.apply(b,a)},show:function(){var a=this;a.modal.appendChild(a.modal.head),a.modal.appendChild(a.modal.inner),a.modal.appendChild(a.modal.buttons),a.bg.appendChild(a.modal),a.bg=document.body.appendChild(a.bg)},close:function(){var a=this;document.body.removeChild(a.bg)}}}(window.Preview=window.Preview||function(a){this.init(a)}),function(a){a.resizeable=function(b,c){if(void 0!=b){if("set"==c||"both"==c){var d=lib.newEL("div",{style:{position:"absolute",height:".75em",width:".75em",bottom:"0px",right:"0px",zIndex:100,cursor:"se-resize",MozAppearance:"resizer",webkitAppearance:"resizer"},className:"resize-handle"});b.resizeHandle=b.appendChild(d),b.resizeHandle.onmousedown=function(c){c.cancelBubble=!0,a.resizeable.mousedown(b,c)},b.resizeHandle.addEventListener("touchstart",function(c){c.preventDefault(),c.cancelBubble=!0,a.resizeable.mousedown(b,c.touches[0])})}("remove"==c||"unset"==c||"none"==c)&&(b.style.resize="none",b.resizeHandle&&b.resizeHandle.parentNode==b&&b.removeChild(b.resizeHandle))}},a.resizeable.mousedown=function(b,c){b.resizeableOffsetX=c.clientX,b.resizeableOffsetY=c.clientY,b.resizeableWidth=b.offsetWidth,b.resizeableHeight=b.offsetHeight,b.setAttribute("draggable","false");var d={};d.mov=window.onmousemove,d.up=window.onmouseup;var e=function(c){a.resizeable.mousemove(b,c.touches[0])};window.onmousemove=function(c){a.resizeable.mousemove(b,c)},window.addEventListener("touchmove",e),window.onmouseup=function(){window.onmousemove=d.mov,window.onmouseup=d.up,window.removeEventListener("touchmove",e),window.removeEventListener("touchend",window.onmouseup),b.resizeableOffsetX=void 0,b.resizeableOffsetY=void 0,b.resizeableWidth=void 0,b.resizeableHeight=void 0,b.setAttribute("draggable","auto"),b.ontransformed({target:b})},window.addEventListener("touchend",window.onmouseup)},a.resizeable.mousemove=function(a,b){a.style.width=b.clientX-a.resizeableOffsetX+a.resizeableWidth+"px",a.style.height=b.clientY-a.resizeableOffsetY+a.resizeableHeight+"px"}}(window.UI=window.UI||function(){}),function(a){a.prototype={add:function(a,b,c){var d=this;for(var e in c){{var f=c[e];d.slideshow.addResource(f.resource,f.resource.name)}a.resources=a.resources||{},a.resources[f.resource.name]=f.link}++d.ID_CT;a.elem_id=ID_CT,d.elements[ID_CT]=a,d.elements[ID_CT].onupdate=function(a){d.elements[a.elem_id]=a}},setBackground:function(a,b){var c=this;slideshow.addResource(a,b),c.background[b]=a},nextID:function(){return this.ID_CT+1},save:function(){view(!0);var a=this,b=[],c={};c.background=[],lib.foreach(a.background,function(a,b){c.background.push(b)});for(var d in a.elements){var e=a.elements[d],f={};f.type=e.tagName,f.innerHTML=e.innerHTML,f.top=e.top,f.left=e.left,f.height=e.height,f.width=e.width,f.id=e.id,f.className=e.className,f.resources=e.resources,b.push(f)}return setEdit(!0),c.elems=b,c},load:function(a){var b=this;if(b.elements=[],a.background&&a.background.length>0){var c=a.background[0];b.background[c]=b.archive.get(c)}for(var d in a.elems){var e=a.elems[d],f=document.createElement(e.type);f.width=e.width,f.height=e.height,f.top=e.top,f.left=e.left,f.className=e.className,f.innerHTML=e.innerHTML,f.id=e.id,b.linkElemResources(f,e.resources),b.ID_CT=b.elements.push(f)}},linkElemResources:function(a,b){var c=this;for(var d in b){var e=b[d],f=c.archive.get(d);"url"==e.type?lib.follow(a,e.id,URL.createObjectURL(f)):"css"==e.type&&lib.follow(a,e.id,"url("+URL.createObjectURL(f)+")")}},render:function(a,b){var c=this;if(0!=Object.keys(c.background).length)for(var d in c.background)void 0==c.background[d].url&&(c.background[d].url='url("'+URL.createObjectURL(c.background[d])+'")'),a.style.backgroundImage!=c.background[d].url&&(a.style.backgroundImage=c.background[d].url);else a.style.backgroundImage="";a.innerHTML="";for(var e in this.elements){var f=this.elements[e];null!=f&&a.appendChild(f)}b?setEdit():resize()},next:function(){return!1},back:function(){return!1}}}(window.Slide=window.Slide||function(a,b){var c=this;c.elements=[],c.ID_CT=0,c.id=-1,c.background={},c.resources={},void 0!=a&&(c.archive=a),void 0!=b&&c.load(b)}),function(a){a.prototype={archive:null,onload:null,slides:[],currentSlide:null,load:function(a,b){var c=this;c.slides=[],c.archive.load(a,function(a){Archive.read_String(a.get("package.json"),function(a){var d=JSON.parse(a);for(s in d.slides){var e=new Slide(c.archive,d.slides[s]);e.slideshow=c;var f=c.slides.push(e);c.slides[f-1].id=f-1}void 0!=b&&b(c),null!=c.onload&&c.onload(c)})})},save:function(){var a=this,b={slides:[]};for(slide in a.slides)b.slides.push(a.slides[slide].save());var c=JSON.stringify(b),d=new Blob([c],{type:"aplication/json"});return a.archive.add(d,"package.json",{}),a.archive.getBlob()},getArchive:function(){return this.archive},addSlide:function(a){var b=this.slides.push(a);return b--,this.slides[b].id=b,this.slides[b].slideshow=this,this.slides[b]},removeSlide:function(a){self.slides[a.id].delete(),self.slides.remove(a.id)},addResource:function(a,b){var c=this;return b in c.archive.list()?archive.get(b):c.archive.add(a,b,{})},next:function(a){var b=this;if(null==b.currentSlide)return b.start(a);if(0==b.currentSlide.next(a)){var c=b.currentSlide.id;return b.render(c+1,a)}},back:function(a){var b=this;if(null==b.currentSlide)return b.start(a);if(0==b.currentSlide.back(a)){var c=b.currentSlide.id;return b.render(c-1,a)}},render:function(a,b,c){void 0==c&&(c=!0);var d=this;return a>=0&&a<d.slides.length?(d.slides[a].render(b),c&&(d.currentSlide=d.slides[a]),!0):!1},start:function(a){var b=this;b.render(0,a,!0)}}}(window.SlideShow=window.SlideShow||function(){this.archive=new Archive}),function(a){a.events=a.events||{},a.events.touchstart=function(a){1==a.targetTouches.length&&(a.target.touchStartX=a.targetTouches[0].pageX,a.target.touchStartY=a.targetTouches[0].pageY)},a.events.touchmove=function(a){tg=a.target,1==a.targetTouches.length&&(a.preventDefault(),tg.touchLengthX=a.targetTouches[0].pageX-tg.touchStartX,tg.touchLengthY=a.targetTouches[0].oageY-tg.touchStartY)},a.events.touchend=function(a){if(tg=a.target,tg.touchLengthX>30){var b=new CustomEvent("swiperight",{detail:{swipeLength:Math.abs(tg.touchLengthX)}});tg.dispatchEvent(b)}if(tg.touchLengthX<-30){var b=new CustomEvent("swipeleft",{detail:{swipeLength:Math.abs(tg.touchLengthX)}});tg.dispatchEvent(b)}},a.events.touchcancel=function(a){a.preventDefault},a.touch=function(b){b.addEventListener("touchstart",a.events.touchstart),b.addEventListener("touchmove",a.events.touchmove),b.addEventListener("touchend",a.events.touchend),b.addEventListener("touchcancel",a.events.touchcancel)}}(window.UI=window.UI||function(){}),function(a){a.hide=function(a){a.style.visibility="hidden"},a.show=function(a){a.style.visibility="visible"}}(window.UI=window.UI||function(){});var RFS=function(a){return a.requestFullScreen||a.webkitRequestFullScreen||a.msRequestFullScreen||a.mozRequestFullScreen||null},getRFSN=function(){var a=RFS(document.body);return null==a?"focus":RFS(document.body).name};window.getRFS=getRFSN,function(){var a={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},b="webkit moz o ms khtml".split(" ");if(void 0!==document.cancelFullScreen)a.supportsFullScreen=!0;else for(var c=0,d=b.length;d>c;c++)if(a.prefix=b[c],void 0!==document[a.prefix+"CancelFullScreen"]){a.supportsFullScreen=!0;break}a.supportsFullScreen&&(a.fullScreenEventName=a.prefix+"fullscreenchange",a.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},a.requestFullScreen=function(a){return""===this.prefix?a.requestFullScreen():a[this.prefix+"RequestFullScreen"]()},a.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}),window.fullScreenApi=a}();var winW=0,winH=0,emSize=0,count=0,touchStartX=0,touchStartY=0,subElemCount=0,level=0,remote=!1,edit=!0,active=null,background=null,slide_background="",Remote_last="",ID_CT=0,slideshow=null,slide=null,savedHTML=null,current=null,lastSlideHash="",aspect=16/9,lastClick={},files={};UI.events={},UI.events.keyboard=function(a){39==a.keyCode?next():37==a.keyCode&&back()},UI.events.mouse=function(a){0==a.button&&(a.clientX>active.clientWidth/2?next():back())},UI.events.fsChange=function(a){var b=document.webkitFullscreenElement||document.mozFullscreenElement||document.msFullscreenElement||document.fullscreenElement;b||(location.hash="/edit")},function(a){a.follow=function(a,b,c){var d=a,e=b.split(".");for(var f in e)f==e.length-1&&void 0!=c&&(d[e[f]]=c),d=d[e[f]];return d},a.apply=function(b,c){return a.foreach(c,function(a,c){b[c]=a}),b},a.foreach=function(a,b){if(void 0!=a.length)for(var c=0;c<a.length;c++){var d=a[c];b(d,c)}else for(var c in a){var d=a[c];b(d,c)}},a.sel=function(a){return document.querySelectorAll(a)},a.selID=function(a){return document.getElementById(a)},a.selClass=function(a){return document.getElementsByClassName(a)},a.setAtr=function(b,c){return a.foreach(c,function(a,c){b.setAttribute(c,a)}),b},a.matches=function(a,b){if(a.webkitMatchesSelector)return a.webkitMatchesSelector(b);if(a.mozMatchesSelector)return a.mozMatchesSelector(b);if(a.msMatchesSelector)return a.msMatchesSelector(b);if(a.matches)return a.matches(b);for(var c=a.parentNode.querySelectorAll(b),d=0;d<c.length;d++)if(c[d]==a)return!0;return!1},a.newEL=function(b,c){var d=document.createElement(b);return a.foreach(c,function(b,c){"attributes"==c?d=a.setAtr(d,b):"style"==c?a.apply(d.style,b):d[c]=b}),d}}(window.lib=window.lib||{});